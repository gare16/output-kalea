import{I as y,B as C,J as f,X as n,S as I,Q as P,r as h,j as o,P as $,C as Q}from"./index-ByLk8s-j.js";import{u as F,a as M}from"./useMutation-D8PU-YPJ.js";import{u as R}from"./useMaterials-CtTrU3Ez.js";import{f as A}from"./dateFormatter-Bb4_azhc.js";import{D as O}from"./DynamicEditModal-Bhzcpj13.js";import{D as G}from"./DynamicDeleteModal-C1L8R17p.js";import{T as K}from"./TablesWidget13-CYdTlftt.js";import"./Modal-DB3yoVLU.js";import"./ThemeProvider-DRjQDZAD.js";import"./hasClass-BOwTM1yB.js";import"./DataKey-jIVlRIQi.js";import"./Button-BI5PMaMy.js";import"./Form-BFxoF8LL.js";import"./FormCheckInput-DWF_ryow.js";import"./warning-C3dqfjue.js";const T=async()=>(await y.get("/material-stock?start=0&length=100")).data.data,W=async s=>(await y.post("/material-stock",s)).data.data,H=async(s,l)=>(await y.put(`/material-stock/${s}`,l)).data.data,L=async s=>{await y.delete(`/material-stock/${s}`)},U=async s=>(await y.post("/material-stock/approval",s)).data.data,B=()=>{const s=C(),{data:l=[],isLoading:d,error:S}=F({queryKey:["material-stocks"],queryFn:T}),k=M({mutationFn:e=>W(e),onSuccess:()=>{s.invalidateQueries({queryKey:["material-stocks"]}),n.success("Material stock berhasil ditambahkan")},onError:e=>{var i;const t=e instanceof f?(i=e.response)==null?void 0:i.data.message:`Gagal menambahkan material stock: ${e.message}`;Array.isArray(t)?t.forEach(r=>n.error(r)):n.error(t)}}),g=M({mutationFn:({id:e,payload:t})=>H(e,t),onSuccess:()=>{s.invalidateQueries({queryKey:["material-stocks"]}),n.success("Material stock berhasil diperbarui")},onError:e=>{var i;const t=e instanceof f?(i=e.response)==null?void 0:i.data.message:`Gagal memperbarui material stock: ${e.message}`;Array.isArray(t)?t.forEach(r=>n.error(r)):n.error(t)}}),m=M({mutationFn:L,onSuccess:()=>{s.invalidateQueries({queryKey:["material-stocks"]}),n.success("Material stock berhasil dihapus")},onError:e=>{var i;const t=e instanceof f?(i=e.response)==null?void 0:i.data.message:`Gagal menghapus material stock: ${e.message}`;Array.isArray(t)?t.forEach(r=>n.error(r)):n.error(t)}}),c=M({mutationFn:e=>U(e),onSuccess:()=>{s.invalidateQueries({queryKey:["material-stocks"]}),n.success("Material stock berhasil disetujui")},onError:e=>{var i;const t=e instanceof f?(i=e.response)==null?void 0:i.data.message:`Gagal menyetujui material stock: ${e.message}`;Array.isArray(t)?t.forEach(r=>n.error(r)):n.error(t)}});return{materialStocks:l,isLoading:d,error:S,addMaterialStock:k.mutate,updateMaterialStock:g.mutate,deleteMaterialStock:m.mutate,approveMaterialStock:c.mutate,isAdding:k.isPending,isUpdating:g.isPending,isDeleting:m.isPending,isApproving:c.isPending}},J=[{title:"Inventory",path:"/inventory",isSeparator:!1,isActive:!1}],de=()=>{const{currentUser:s}=I(),l=P(),{materialStocks:d,isLoading:S,updateMaterialStock:k,deleteMaterialStock:g}=B(),{materials:m}=R(),[c,e]=h.useState(!1),[t,i]=h.useState(!1),[r,b]=h.useState(null),[u,E]=h.useState(null),_=m.map(a=>({id:a.id,material_name:a.material_name,material_code:"-",uom:a.unit_of_measure,qty:"-",price:"-",created_dt:A(a.created_dt),changed_dt:a.changed_dt?A(a.changed_dt):"-"})),D=[{key:"material_name",label:"Material Name"},{key:"uom",label:"UOM"},{key:"qty",label:"Qty"},{key:"price",label:"Price"},{key:"status",label:"Status"},{key:"created_dt",label:"Created Date"},{key:"changed_dt",label:"Changed Date"}],x=[{key:"status",label:"Status",options:["APPROVED","PENDING","REJECTED"]}],q=a=>{b(a),e(!0)},j=a=>{r&&(s!=null&&s.id)&&(k({id:r.id,payload:{material_id:a.material_id,qty:parseInt(a.qty),price:parseFloat(a.price),user_id:s.id}}),e(!1),b(null))},N=a=>{E(a),i(!0)},w=()=>{u&&(g(u.id),i(!1),E(null))};return S?o.jsx("div",{className:"card",children:o.jsxs("div",{className:"card-body text-center py-10",children:[o.jsx("div",{className:"spinner-border text-primary",role:"status",children:o.jsx("span",{className:"visually-hidden",children:"Loading..."})}),o.jsx("div",{className:"mt-3",children:"Memuat data Material Stock..."})]})}):o.jsxs(o.Fragment,{children:[o.jsx($,{breadcrumbs:J,children:"Inventory Stock Material"}),o.jsxs(Q,{children:[o.jsx(K,{className:"card-xl-stretch",rows:_,columns:D,labelAdd:"Add Stock",filters:x,onAdd:()=>l("/inventory/stock-material/add"),onEdit:a=>{const p=d.find(v=>v.id===a.id);p&&q(p)},onDelete:a=>{const p=d.find(v=>v.id===a.id);p&&N(p)},roleAccess:{edit:["ADMIN","OWNER","WAREHOUSE"],add:["ADMIN","OWNER","WAREHOUSE"]}}),c&&r&&o.jsx(O,{show:c,title:"Edit Material Stock",fields:[{name:"material_id",label:"Material",type:"select",required:!0,options:m.map(a=>({value:a.id,label:`${a.material_name} (${a.unit_of_measure})`}))},{name:"qty",label:"Quantity",type:"number",required:!0,placeholder:"Masukkan quantity"},{name:"price",label:"Price",type:"number",required:!1,placeholder:"Masukkan price"}],initialData:{material_id:r.material.id,qty:r.qty.toString(),price:r.price.toString()},onSave:j,onClose:()=>{e(!1),b(null)}}),t&&u&&o.jsx(G,{show:t,title:"Hapus Material Stock",itemName:`${u.material.material_name} (${u.qty})`,onConfirm:w,onClose:()=>{i(!1),E(null)}}),(c||t)&&o.jsx("div",{className:"modal-backdrop fade show"})]})]})};export{de as default};
