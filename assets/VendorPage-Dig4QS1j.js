import{r as o,a2 as K,j as i,_ as w,k as R}from"./index-C8bs7RZm.js";import{T as $}from"./TablesWidget13-CxemlcYz.js";import{D as W}from"./DynamicEditModal-Bez90ZYm.js";import{D as L,a as O}from"./DynamicDeleteModal-CQyqsHoG.js";import{u as B}from"./useVendors-9PVWaASE.js";import{f as g}from"./dateFormatter-BAS1RcD3.js";import"./ThemeProvider-BoXIQX2b.js";import"./Modal-BZ9Bjo3z.js";import"./hasClass-D44ucA8r.js";import"./useMutation-DVRIQfZo.js";import"./warning-ClC9Fe-s.js";const H=[{title:"Dashboard",path:"/dashboard",isSeparator:!1,isActive:!1}],ne=()=>{const[y,m]=o.useState(!1),[x,p]=o.useState(!1),[f,u]=o.useState(!1),[a,l]=o.useState(null),[c,N]=o.useState([]),[P,_]=o.useState([]),[v,d]=o.useState([]),{currentUser:h}=K(),{vendors:q,isLoading:j,addVendor:k,updateVendor:D,deleteVendor:S}=B();o.useEffect(()=>{(async()=>{try{const n=await(await fetch("https://www.emsifa.com/api-wilayah-indonesia/api/provinces.json")).json();N(n)}catch(t){console.error("Failed to fetch provinces",t)}})()},[]);const b=async e=>{try{return await(await fetch(`https://www.emsifa.com/api-wilayah-indonesia/api/regencies/${e}.json`)).json()}catch(t){return console.error("Failed to fetch regencies",t),[]}},V=q.map(e=>({...e,location:`${e.city}, ${e.province}${e.country?`, ${e.country}`:""}`,created_dt:g(e.created_dt),changed_dt:e.changed_dt?g(e.changed_dt):"-"})),E=[{key:"name",label:"Nama",className:"min-w-140px"},{key:"contact_person",label:"Contact Person",className:"min-w-140px"},{key:"phone",label:"Phone",className:"min-w-120px"},{key:"email",label:"Email",className:"min-w-120px"},{key:"address",label:"Alamat",className:"min-w-120px"},{key:"location",label:"Lokasi",className:"min-w-150px"},{key:"zip_code",label:"Kode Pos",className:"min-w-100px"},{key:"tax_number",label:"NPWP",className:"min-w-120px"},{key:"created_by",label:"Dibuat Oleh",className:"min-w-120px"},{key:"created_dt",label:"Tanggal Dibuat",className:"min-w-120px"},{key:"changed_by",label:"Diubah Oleh",className:"min-w-120px"},{key:"changed_dt",label:"Tanggal Diubah",className:"min-w-120px"}],A=e=>{l(e),m(!0)},C=()=>{a&&(S(a.id),m(!1),l(null))},M=e=>{l(e),p(!0);const t=c.find(n=>n.name===e.province);t?b(t.id).then(n=>d(n.map(s=>({id:s.id,name:s.name})))):d([])},z=e=>{a&&(D({id:a.id,vendor:{name:e.name,contact_person:e.contact_person,phone:e.phone,email:e.email,address:e.address,city:e.city,province:e.province,zip_code:e.zip_code,tax_number:e.tax_number}}),p(!1),l(null))},T=()=>{u(!0)},F=e=>{k({name:e.name,contact_person:e.contact_person,phone:e.phone,email:e.email,address:e.address,city:e.city,province:e.province,zip_code:e.zip_code,tax_number:e.tax_number,is_active:e.is_active,user_id:h==null?void 0:h.full_name}),u(!1)};return j?i.jsx(w,{children:i.jsxs("div",{className:"card-body text-center py-10",children:[i.jsx("div",{className:"spinner-border text-primary",role:"status",children:i.jsx("span",{className:"visually-hidden",children:"Loading..."})}),i.jsx("div",{className:"mt-3",children:"Memuat data vendor..."})]})}):i.jsxs("div",{className:"container-fluid",children:[i.jsx(R,{breadcrumbs:H,children:"Master Vendor"}),i.jsx(w,{children:i.jsx($,{className:"card-xl-stretch",rows:V,columns:E,labelAdd:"Vendor",onDelete:A,onEdit:M,onAddClick:T})}),y&&a&&i.jsx(L,{show:y,title:"Hapus Vendor",itemName:a.name,onConfirm:C,onClose:()=>{m(!1),l(null)}}),x&&a&&i.jsx(W,{show:x,title:"Edit Vendor",fields:[{name:"name",label:"Nama",type:"text",required:!0,icon:"user"},{name:"contact_person",label:"Contact Person",type:"text",required:!0,icon:"user"},{name:"phone",label:"Phone",type:"text",required:!0,icon:"phone"},{name:"email",label:"Email",type:"text",required:!0,icon:"email"},{name:"province",label:"Provinsi",type:"select",required:!0,icon:"map",options:c.map(e=>({value:e.name,label:e.name})),onChange:async(e,t)=>{const n=c.find(s=>s.name===e);if(n){const s=await b(n.id);d(s.map(r=>({id:r.id,name:r.name}))),t.setFieldValue("city","")}else d([]),t.setFieldValue("city","")}},{name:"city",label:"Kota",type:"select",required:!0,icon:"map",options:v.map(e=>({value:e.name,label:e.name}))},{name:"address",label:"Alamat",type:"textarea",required:!0,icon:"map"},{name:"zip_code",label:"Kode Pos",type:"text",required:!0,icon:"map"},{name:"tax_number",label:"NPWP",type:"text",required:!1,icon:"document"}],initialData:{name:a.name,contact_person:a.contact_person,phone:a.phone,email:a.email,address:a.address,province:a.province,city:a.city,zip_code:a.zip_code,tax_number:a.tax_number},onSave:z,onClose:()=>{p(!1),l(null)}}),f&&i.jsx(O,{show:f,title:"Tambah Vendor",fields:[{name:"name",label:"Nama",type:"text",required:!0,icon:"user"},{name:"contact_person",label:"Contact Person",type:"text",required:!0,icon:"user"},{name:"phone",label:"Phone",type:"text",required:!0,icon:"phone"},{name:"email",label:"Email",type:"text",required:!0,icon:"email"},{name:"province",label:"Provinsi",type:"select",required:!0,icon:"map",options:c.map(e=>({value:e.name,label:e.name})),onChange:async(e,t)=>{const n=c.find(s=>s.name===e);if(n){const s=await b(n.id);_(s.map(r=>({id:r.id,name:r.name}))),t.setFieldValue("city","")}else _([]),t.setFieldValue("city","")}},{name:"city",label:"Kota",type:"select",required:!0,icon:"map",options:P.map(e=>({value:e.name,label:e.name}))},{name:"address",label:"Alamat",type:"textarea",required:!0,icon:"map"},{name:"zip_code",label:"Kode Pos",type:"text",required:!0,icon:"map"},{name:"tax_number",label:"NPWP",type:"text",required:!1,icon:"document"},{name:"is_active",label:"Status Aktif",type:"checkbox",required:!1,icon:"check-circle"}],onSubmit:F,onClose:()=>u(!1)})]})};export{ne as default};
