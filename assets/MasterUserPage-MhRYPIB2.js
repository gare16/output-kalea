import{I as f,B as F,J as w,G as n,r as h,S as T,j as r,H as N,P as B}from"./index-ByLk8s-j.js";import{T as R}from"./TablesWidget13-CYdTlftt.js";import{D as K}from"./DynamicEditModal-Bhzcpj13.js";import{D as Q}from"./DynamicDeleteModal-C1L8R17p.js";import{D as $}from"./DynamicFormModal-BoHJvk0i.js";import{u as G,a as U}from"./useMutation-D8PU-YPJ.js";import{u as P}from"./useRoles-C7e91FBu.js";import{f as D}from"./dateFormatter-Bb4_azhc.js";import{S as L}from"./StatusBadge-CzBlVyeX.js";import"./ThemeProvider-DRjQDZAD.js";import"./FormCheckInput-DWF_ryow.js";import"./Modal-DB3yoVLU.js";import"./hasClass-BOwTM1yB.js";import"./DataKey-jIVlRIQi.js";import"./Button-BI5PMaMy.js";import"./Form-BFxoF8LL.js";import"./warning-C3dqfjue.js";const H=async()=>(await f.get("/user?start=0&length=100")).data.data,I=async t=>(await f.post("/user",t)).data.data,O=async(t,m)=>(await f.put(`/user/${t}`,m)).data.data,z=async t=>{await f.delete(`/user/${t}`)},J=()=>{const t=F(),{data:m=[],isLoading:p,error:_}=G({queryKey:["users"],queryFn:H}),k=U({mutationFn:a=>I(a),onSuccess:()=>{t.invalidateQueries({queryKey:["users"]}),n.success("User berhasil ditambahkan")},onError:a=>{var l;const s=a instanceof w?(l=a.response)==null?void 0:l.data.message:`Gagal menambahkan user: ${a.message}`;Array.isArray(s)?s.forEach(o=>n.error(o)):n.error(s)}}),y=U({mutationFn:({id:a,user:s})=>O(a,s),onSuccess:()=>{t.invalidateQueries({queryKey:["users"]}),n.success("User berhasil diperbarui")},onError:a=>{var l;const s=a instanceof w?(l=a.response)==null?void 0:l.data.message:`Gagal memperbarui user: ${a.message}`;Array.isArray(s)?s.forEach(o=>n.error(o)):n.error(s)}}),b=U({mutationFn:z,onSuccess:()=>{t.invalidateQueries({queryKey:["users"]}),n.success("User berhasil dihapus")},onError:a=>{var l;const s=a instanceof w?(l=a.response)==null?void 0:l.data.message:`Gagal menghapus user: ${a.message}`;Array.isArray(s)?s.forEach(o=>n.error(o)):n.error(s)}});return{users:m,isLoading:p,error:_,addUser:k.mutate,updateUser:y.mutate,deleteUser:b.mutate}},W=[{title:"Dashboard",path:"/dashboard",isSeparator:!1,isActive:!1},{title:"Master User",path:"/master-user",isSeparator:!0,isActive:!0}],pe=()=>{const{users:t,isLoading:m,addUser:p,updateUser:_,deleteUser:k}=J(),{roles:y}=P(),[b,a]=h.useState(!1),[s,l]=h.useState(!1),[o,x]=h.useState(!1),[i,d]=h.useState(null),{currentUser:c}=T(),S=[{key:"first_name",label:"Nama Depan",className:"min-w-150px"},{key:"last_name",label:"Nama Belakang",className:"min-w-150px"},{key:"username",label:"Username",className:"min-w-150px"},{key:"email",label:"Email",className:"min-w-200px"},{key:"role",label:"Role",className:"min-w-120px"},{key:"is_active",label:"Status",className:"min-w-100px"},{key:"created_by",label:"Dibuat Oleh",className:"min-w-120px"},{key:"created_dt",label:"Dibuat Tanggal",className:"min-w-140px"},{key:"changed_by",label:"Diubah Oleh",className:"min-w-120px"},{key:"changed_dt",label:"Diubah Tanggal",className:"min-w-140px"}],M=t.map(e=>({id:e.id,first_name:e.first_name,last_name:e.last_name,username:e.username,email:e.email,role:e.role,is_active:r.jsx(L,{status:e.is_active?"active":"in_active"}),created_by:e.created_by,created_dt:D(e.created_dt),changed_by:e.changed_by||"-",changed_dt:e.changed_dt?D(e.changed_dt):"-"})),E=()=>{a(!0)},A=e=>{p({first_name:e.first_name,last_name:e.last_name,username:e.username,email:e.email,password:e.password,role:e.role,is_active:e.is_active,user_id:c==null?void 0:c.full_name}),a(!1)},q=e=>{const u=t.find(g=>g.id===e.id);u&&(d(u),l(!0))},v=e=>{i&&(_({id:i.id,user:{first_name:e.first_name,last_name:e.last_name,email:e.email,role:e.role,is_active:e.is_active,user_id:c==null?void 0:c.full_name}}),l(!1),d(null))},j=e=>{const u=t.find(g=>g.id===e.id);u&&(d(u),x(!0))},C=()=>{i&&(k(i.id),x(!1),d(null))};return m?r.jsx(N,{children:r.jsxs("div",{className:"card-body text-center py-10",children:[r.jsx("div",{className:"spinner-border text-primary",role:"status",children:r.jsx("span",{className:"visually-hidden",children:"Loading..."})}),r.jsx("div",{className:"mt-3",children:"Memuat data user..."})]})}):r.jsxs("div",{className:"container-fluid",children:[r.jsx(B,{breadcrumbs:W,children:"Master User"}),r.jsx(N,{children:r.jsx(R,{className:"card-xl-stretch",rows:M,columns:S,labelAdd:"Add User",filters:[{key:"first_name",label:"Filter by Nama Depan"},{key:"last_name",label:"Filter by Nama Belakang"},{key:"username",label:"Filter by Username"},{key:"email",label:"Filter by Email"},{key:"role",label:"Filter by Role"}],onDelete:j,onEdit:q,onAdd:E})}),b&&r.jsx($,{show:b,title:"Tambah User",fields:[{name:"first_name",label:"Nama Depan",type:"text",required:!0,icon:"user",placeholder:"Masukkan nama depan"},{name:"last_name",label:"Nama Belakang",type:"text",required:!0,icon:"user",placeholder:"Masukkan nama belakang"},{name:"username",label:"Username",type:"text",required:!0,icon:"user",placeholder:"Masukkan username"},{name:"email",label:"Email",type:"text",required:!0,icon:"sms",placeholder:"Masukkan email user"},{name:"password",label:"Password",type:"password",required:!0,icon:"password-check",placeholder:"Masukkan password user"},{name:"role",label:"Role",type:"select",required:!0,icon:"shield",options:y.map(e=>({value:e.name,label:e.name}))},{name:"is_active",label:"Status Aktif",type:"checkbox",required:!1,icon:"check-circle"}],onSubmit:A,onClose:()=>a(!1)}),i&&r.jsx(K,{show:s,title:"Edit User",fields:[{name:"first_name",label:"Nama Depan",type:"text",required:!0,icon:"user"},{name:"last_name",label:"Nama Belakang",type:"text",required:!0,icon:"user"},{name:"email",label:"Email",type:"text",required:!0,icon:"email"},{name:"role",label:"Role",type:"select",required:!0,icon:"shield",options:y.map(e=>({value:e.name,label:e.name}))},{name:"is_active",label:"Status Aktif",type:"checkbox",required:!1,icon:"check-circle"}],initialData:{first_name:i.first_name,last_name:i.last_name,email:i.email,role:i.role,is_active:i.is_active},onSave:v,onClose:()=>{l(!1),d(null)}}),i&&r.jsx(Q,{show:o,title:"Hapus User",itemName:i.username,onConfirm:C,onClose:()=>{x(!1),d(null)}})]})};export{pe as default};
